#!/usr/bin/env python3\n\"\"\"\næœ€ç»ˆä¿®å¤æ‰€æœ‰é—®é¢˜çš„è„šæœ¬\n\"\"\"\n\nimport sys\nimport os\nsys.path.append(os.getcwd())\n\ndef main():\n    print(\"ğŸ”§ æœ€ç»ˆä¿®å¤æ‰€æœ‰é—®é¢˜...\")\n    \n    try:\n        # 1. æ£€æŸ¥æ•°æ®æ–‡ä»¶\n        from pathlib import Path\n        data_file = Path(\"data/events_ga4.ndjson\")\n        if not data_file.exists():\n            print(\"âŒ æ•°æ®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œç”Ÿæˆæµ‹è¯•æ•°æ®...\")\n            os.system(\"python generate_clean_data.py\")\n        else:\n            print(\"âœ… æ•°æ®æ–‡ä»¶å­˜åœ¨\")\n        \n        # 2. æµ‹è¯•åŸºæœ¬å¯¼å…¥\n        print(\"ğŸ“¦ æµ‹è¯•åŸºæœ¬å¯¼å…¥...\")\n        from tools.ga4_data_parser import GA4DataParser\n        from tools.data_storage_manager import DataStorageManager\n        import pandas as pd\n        print(\"âœ… åŸºæœ¬å¯¼å…¥æˆåŠŸ\")\n        \n        # 3. æµ‹è¯•æ•°æ®è§£æ\n        print(\"ğŸ” æµ‹è¯•æ•°æ®è§£æ...\")\n        parser = GA4DataParser()\n        raw_data = parser.parse_ndjson(str(data_file))\n        print(f\"âœ… è§£æäº† {len(raw_data)} ä¸ªäº‹ä»¶\")\n        \n        # 4. æµ‹è¯•äº‹ä»¶æå–å’Œåˆå¹¶\n        print(\"ğŸ”„ æµ‹è¯•äº‹ä»¶æå–å’Œåˆå¹¶...\")\n        events_data = parser.extract_events(raw_data)\n        \n        if isinstance(events_data, dict):\n            all_events_list = []\n            for event_type, event_df in events_data.items():\n                if not event_df.empty:\n                    all_events_list.append(event_df)\n            \n            if all_events_list:\n                combined_events = pd.concat(all_events_list, ignore_index=True)\n                print(f\"âœ… åˆå¹¶äº† {len(events_data)} ç§äº‹ä»¶ç±»å‹ï¼Œæ€»è®¡ {len(combined_events)} ä¸ªäº‹ä»¶\")\n            else:\n                combined_events = pd.DataFrame()\n        else:\n            combined_events = events_data\n        \n        # 5. æµ‹è¯•å­˜å‚¨\n        print(\"ğŸ’¾ æµ‹è¯•æ•°æ®å­˜å‚¨...\")\n        storage_manager = DataStorageManager()\n        storage_manager.store_events(combined_events)\n        \n        stored_events = storage_manager.get_data('events')\n        if stored_events is not None and not stored_events.empty:\n            print(f\"âœ… å­˜å‚¨æˆåŠŸï¼Œäº‹ä»¶æ•°: {len(stored_events)}\")\n        else:\n            print(\"âŒ å­˜å‚¨å¤±è´¥\")\n            return False\n        \n        # 6. æµ‹è¯•åˆ†æå¼•æ“\n        print(\"ğŸ§ª æµ‹è¯•åˆ†æå¼•æ“...\")\n        from engines.event_analysis_engine import EventAnalysisEngine\n        from engines.retention_analysis_engine import RetentionAnalysisEngine\n        \n        event_engine = EventAnalysisEngine(storage_manager)\n        event_result = event_engine.analyze_events(stored_events)\n        print(f\"âœ… äº‹ä»¶åˆ†æ: {event_result.get('status', 'unknown')}\")\n        \n        retention_engine = RetentionAnalysisEngine(storage_manager)\n        retention_result = retention_engine.analyze_retention(stored_events)\n        print(f\"âœ… ç•™å­˜åˆ†æ: {retention_result.get('status', 'unknown')}\")\n        \n        # 7. æµ‹è¯•é›†æˆç®¡ç†å™¨\n        print(\"ğŸ”— æµ‹è¯•é›†æˆç®¡ç†å™¨...\")\n        from system.integration_manager import IntegrationManager, WorkflowConfig\n        \n        config = WorkflowConfig(\n            enable_parallel_processing=False,\n            max_workers=2,\n            timeout_minutes=5,\n            enable_caching=True,\n            auto_cleanup=True\n        )\n        \n        integration_manager = IntegrationManager(config)\n        \n        # æµ‹è¯•å•ä¸ªåˆ†æ\n        single_result = integration_manager._execute_single_analysis('event_analysis')\n        print(f\"âœ… é›†æˆç®¡ç†å™¨å•ä¸ªåˆ†æ: {single_result.status}\")\n        \n        print(\"\\nğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼åº”ç”¨åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚\")\n        return True\n        \n    except Exception as e:\n        print(f\"âŒ æµ‹è¯•å¤±è´¥: {e}\")\n        import traceback\n        traceback.print_exc()\n        return False\n\nif __name__ == \"__main__\":\n    success = main()\n    if success:\n        print(\"\\nğŸš€ ç°åœ¨å¯ä»¥å¯åŠ¨åº”ç”¨äº†:\")\n        print(\"   python start_app_simple.py\")\n        print(\"   æˆ–è€…\")\n        print(\"   streamlit run main.py\")\n    else:\n        print(\"\\nâŒ ä¿®å¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯\")"